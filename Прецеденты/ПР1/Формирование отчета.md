# Формирование отчета


## Описание
Руководитель (Manager) инициирует процесс формирования отчета на основе заданий за указанный период. Отчет позволяет проанализировать состояние выполнения заданий, включая выполненные, находящиеся в работе, не начатые и просроченные.

## Актеры
- **Руководитель (Manager):** Инициирует процесс формирования отчета, выбирает параметры отчета.
- **Система (System):** Обрабатывает запросы, фильтрует задания, рассчитывает статистику, создает отчет.
- **РеестрПроектов (ProjectRegistry):** Предоставляет доступ к проектам и их заданиям.
- **Проект (Project):** Предоставляет доступ к своим заданиям.
- **Задание (Task):** Предоставляет информацию о своем статусе и времени выполнения.
- **Модуль анализа (AnalysisModule):** принимает список заданий (отфильтрованных или всех) и выполняет обработку() вычисляет статистику (количество, время, проценты, распределение по статусам и т.п.), возвращая объект Отчет.
- **Отчет (Report):** Создаваемый объект, содержащий результаты анализа.
- **РеестрОтчетов (ReportRegistry):** Принимает и сохраняет созданные отчеты.
- **Модуль форматирования отчёта (ReportFormatter):** выполняет преобразование объекта «Отчёт» в формат JSON, CSV или TXT.


## Основной поток

1. Руководитель выбирает опцию "Формирование отчета"
2. Система отображает форму параметров отчета, содержащую:
   - **Период** (обязательный параметр):
     - Поле "Дата начала" (с выбором из календаря)
     - Поле "Дата окончания" (с выбором из календаря)
     - **Описание параметра:**
       - В отчет включаются задания, которые:
         - появились (созданы или перешли в любой статус) в указанный период,
         - находятся в статусе Не начато, В работе, Просрочено,
         - либо перешли в статус Выполнено в пределах указанного периода.
       - Если задание перешло в статус Выполнено до начала периода, оно не включается в отчет.
   - **Исполнитель** (опциональный параметр):
     - Выпадающий список со значениями: Все исполнители или конкретный сотрудник (выбрать можно несколько если это не "Все исполнители")
   - **Проект** (опциональный параметр):
     - Выпадающий список со значениями: Все проекты или конкретный проект (выбрать можно несколько если это не "Все проекты")
   - **Статус заданий** (опциональный параметр):
      - Выпадающий список из значений: Все задания, Просрочено, Выполнено, В работе, Не начато (выбрать можно несколько если это не "Все задания")
   - **Формат отчета** (обязательно):
      - Выпадающий список из значение: JSON, CSV, TXT (выбрать можно только один)
3. Руководитель заполняет параметры:
   - Обязательно указывает Формат отчета и Период (дату начала и окончания)
   - При необходимости выбирает  Исполнителя (если оставлено "Все исполнители" - отчет формируется по всем сотрудникам)
   - При необходимости выбирает  Проект (если оставлено "Все проекты" - отчет формируется по всем проектам)
   - При необходимости выбирает  Статус заданий (если оставлено "Все задания" - отчет формируется по всем заданиям)
   - Нажимает кнопку "Сформировать отчет"
4. Система запрашивает у РеестраПроектов список заданий по выбранным критериям
5. РеестрПроектов возвращает список заданий через соответствующие Проекты
6. Система передает список (отфильтрованный или полный) в Модуль анализа.
7. Модуль анализа получает сведения о каждом задании (идентификатор, проект, исполнитель, статус, время начала и окончания (если есть), дедлайн)
8. Модуль анализа выполняет расчеты в соответствии с прецедентом “Расчёт статистики для формирования отчёта”:
9. Модуль анализа возвращает системе результирующий объект «Отчет».
10. Система передает объект "Отчет" в РеестрОтчетов для сохранения. (без файлов формата)
12. РеестрОтчетов подтверждает успешную регистрацию отчета
13. Система передает объект «Отчёт» в модуль ReportFormatter.
14. Модуль ReportFormatter формирует файл отчета:
    - JSON – создаётся структурированный JSON-файл
    - CSV – формируются две таблицы:
      1. список заданий;
      2. статистика
    - TXT – создаётся читаемый текстовый документ с заголовками и блоками данных
15. Модуль ReportFormatter возвращает файл, готовый к скачиванию.
16. Система предлагает пользователю скачать отчет в выбранном формате.
17. Система отображает сообщение «Отчет успешно сформирован» и предлагает просмотреть его.

## Предусловия
- Руководитель аутентифицирован в системе и имеет права на формирование отчетов
- В системе существуют задания (любого статуса)
- РеестрПроектов и РеестрОтчетов доступны и функционируют корректно

## Постусловия
- Создан новый объект "Отчет" с расчетной статистикой
- Отчет зарегистрирован в РеестреОтчетов
- Руководитель получил подтверждение успешного формирования отчета
- Отчет доступен для просмотра и анализа

## Альтернативные потоки

### A1: Отсутствуют данные для отчета

1. Если после фильтрации не найдено заданий по соответствующим критериям
2. Система отображает сообщение "По заданным критериям задания не найдены"
3. Предлагает изменить параметры отчета
4. Прецедент возвращается к шагу 2
