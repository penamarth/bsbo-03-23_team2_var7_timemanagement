# Расчёт статистики для формирования отчёта


## Описание
Прецедент описывает, как Модуль анализа выполняет расчёты по списку заданий: определяет их время выполнения, просрочки, количество по статусам, проценты, а также формирует итоговую статистику для отчёта.
## Актеры
- **Система (System):** передает список заданий
- **Задание (Task):** предоставляет информацию о своем статусе и времени выполнения.
- **Модуль анализа (AnalysisModule):** выполняет вычисления
- **Отчет (Report):** cоздаваемый объект, содержащий результаты анализа.
- **TimeCalculator:** рассчитывает время выполнения
- **StatusCounter:** считает задания по статусам
- **DeadlineAnalyzer:** проверяет выполнение в срок
- **ProgressCalculator:** считает процент выполнения
- **StatisticsBuilder:** собирает итоговую статистику


## Основной поток

1. Модуль анализа получает список отфильтрованных заданий
2. Модуль анализа передаёт в TimeCalculator каждое задание:
   - дату начала 
   - дату окончания (если есть)
   - статус задания
   - срок выполнения (дедлайн)
3. TimeCalculator анализирует данные:
   - Если статус "В работе": Время выполнения = текущее время – время начала
   - Если статус "Выполнено": Время выполнения = время окончания – время начала
   - Если статус "Не начато": Время не рассчитывается, время выполнения = 0
   - Если статус "Просрочено": Время выполнения = текущее время – время начала
4. TimeCalculator возвращает Модулю анализа:
   - рассчитанное время (в минутах/часах)
   - или отметку, что времени нет (если его нельзя посчитать)
5. Модуль анализа передаёт весь список заданий в StatusCounter.
6. StatusCounter проходит по каждому заданию и считает:
   - сколько заданий «Не начато»
   - сколько «В работе»
   - сколько «Выполнено»
   - сколько «Просрочено»
7. StatusCounter возвращает Модулю анализа структуру вида: { НеНачато: X, ВРаботе: Y, Выполнено: Z, Просрочено: W}
8. Модуль анализа передаёт DeadlineAnalyzer список всех выполненных и просроченных заданий и их дедлайны.
9. DeadlineAnalyzer считает общее количество переданных заданий
10. DeadlineAnalyzer считает количество заданий, у которых время окончания ≤ срок выполнения (количество выполненных заданий в срок) и они должны быть в статусе "Выполнено"
11. DeadlineAnalyzer расчитывает процент выполненных в срок заданий от общего числа заданий: (выполненные в срок / общее количество заданий) × 100%
12. DeadlineAnalyzer вычисляет количество просроченных заданий: общее количество заданий - количество выполненных заданий в срок
13. DeadlineAnalyzer расчитывает процент от общего числа просроченных заданий: (количество просроченных заданий / общее количество заданий) × 100%
14. DeadlineAnalyzer передает данные Модулю анализа:
    - количество выполненных заданий в срок
    - процент выполненных в срок заданий от общего числа заданий
    - количество просроченных заданий
    - процент просроченных заданий от общего числа заданий
15. Модуль анализа собирает все задания, для которых TimeCalculator ранее посчитал время.
16. Передаёт их в TimeCalculator для формирования окончательных метрик:
    - Суммарное время = сумма всех рассчитанных интервалов
    - Среднее время = суммарное / количество заданий с рассчитанным временем (если у заданий время выполнения = 0, то не считает его в количество)
17. TimeCalculator возвращает оба значения обратно в Модуль анализа.
18. Модуль анализа передаёт ProgressCalculator:
    - общее количество заданий
    - количество заданий в статусе "Выполнено"
19. ProgressCalculator вычисляет: Процент выполнения = (выполненные / общее количество) × 100%
20. Возвращает результат Модулю анализа.
21. Модуль анализа передаёт StatisticsBuilder все рассчитанные данные:
    - общее количество заданий
    - количество по статусам
    - количество выполненных в срок
    - количество просроченных
    - проценты
    - среднее и суммарное время
    - список заданий
    - параметры отчёта (период, проект, исполнитель, статус, формат)
    - дату и время формирования отчёта
22. StatisticsBuilder собирает всё в итоговый объект "Отчет"
23. StatisticsBuilder передает объект "Отчет" в Модуль анализа
